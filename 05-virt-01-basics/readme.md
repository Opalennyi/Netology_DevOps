## Задача 1

_Опишите кратко, как вы поняли: в чем основное отличие полной (аппаратной) виртуализации, паравиртуализации и виртуализации на основе ОС._

В случае **полной (аппаратной) виртуализации** происходит эмулирование всего аппаратного обеспечения машины, в том числе и процессора; однако высокие накладные расходы на виртуализацию процесса ведут к снижению производительности. При этом, если я правильно понимаю, у нас нет как таковой ОС на хостовой машине, гипервизор работает напрямую на железе хоста, самостоятельно являясь "хостовой ОС". При полной виртуализации гостевая ОС никак не изменяется гипервизором и не знает о том, что она виртуализована.

При **паравиртуализации** происходит модификация ядра гостевой ОС, и взаимодействие между гостевой и ОС и гипервизором происходит при помощи API; это упрощает обработку операций гостевой ОС и, следовательно, повышает производительность. Гостевая ОС при этом знает, что она виртуализована и установлена в виртуальной машине. Гипервизор установлен на ОС хоста, то есть при паравиртуализации появляется дополнительный (по сравнению с аппаратной виртуализацией) слой ОС.

При **виртуализации на уровне ОС (контейнерной виртуализации)** ядро хостовой ОС поддерживает несколько изолированных экземпляров пользовательских пространств хостовой ОС. При виртуализации на уровне ОС виртуализируется не компьютер целиком или ОС, а только пользовательское окружение ОС. Контейнеризация не поддерживает исполнение ОС с ядром, отличным от ядра хостовой ОС, поскольку контейнеры используют общее ядро ОС; при контейнеризации также не существует отдельного слоя гипервизора, управлением контейнерами и разделением аппаратных ресурсов между ними занимается хостовая ОС.

## Задача 2

_Выберите один из вариантов использования организации физических серверов, в зависимости от условий использования._

_Организация серверов:_
- _физические сервера,_
- _паравиртуализация,_
- _виртуализация уровня ОС._

_Условия использования:_
- _Высоконагруженная база данных, чувствительная к отказу._
- _Различные web-приложения._
- _Windows системы для использования бухгалтерским отделом._
- _Системы, выполняющие высокопроизводительные расчеты на GPU._

_Опишите, почему вы выбрали к каждому целевому использованию такую организацию._

**Высоконагруженная база данных, чувствительная к отказу** — паравиртуализация, поскольку это позволит децентрализовать БД, разместив разные ее части в разных ВМ, что повысит отказоустойчивость. Поскольку БД чувствительна к отказу, можем, при необходимость, делать реплики ВМ и наладить поддержку CDP.

**Различные web-приложения** — виртуализация уровня ОС из-за большей простоты в масштабировании. При увеличении нагрузки на сервисы есть возможность быстрее и проще увеличить число контейнеров, обслуживающих сервис, а после снижения нагрузки избавиться от ненужных контейнеров.

**Windows системы для использования бухгалтерским отделом** — паравиртуализация или контейнеризация, не вижу здесь большой разницы. Если сервер работает на  Windows, можем поместить их в контейнер. Если на сервере установлена другая ОС, то паравиртуализация.

**Системы, выполняющие высокопроизводительные расчеты на GPU** — физический сервер, поскольку чем быстрее и более прямо будет организован доступ к GPU без дополнительных прослоек, тем быстрее будут происходить вычисления.

## Задача 3
_Выберите подходящую систему управления виртуализацией для предложенного сценария. Детально опишите ваш выбор._

_Сценарии:_

1. _100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований. Преимущественно Windows based инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий._
2. _Требуется наиболее производительное бесплатное open source решение для виртуализации небольшой (20-30 серверов) инфраструктуры на базе Linux и Windows виртуальных машин._
3. _Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows инфраструктуры._
4. _Необходимо рабочее окружение для тестирования программного продукта на нескольких дистрибутивах Linux._

**Сценарий 1.** Для этого сценария я бы выбрал VMware vSphere. 100 VM'ок — довольно большая инфраструктура, которой нам должно быть максимально удобно управлять без лишних размышлений (и нанять/научить инженеров для нее мы уже явно можем себе позволить).

vCenter — это как раз Windows-based решение для централизованного управления инфраструктурой. Distributed Resource Scheduler (DRS) и Distributed Power Management (DPM) прекрасно решат задачу балансировки нагрузки и даже электроэнергии (если это необходимо), а Predictive DRS еще и примет в расчет, какая нагрузка была раньше, чтобы предположить, как оптимизировать нагрузку в ближайшем будущем.

Предположу, что задачу с репликацией данных решает vSphere Replication. Также в vSphere можно создать расписание бэкапов, они будут создаваться автоматически. Однако, тут у меня есть свой bias — я работаю в Veeam'е и, конечно, считаю, что вместо легаси бэкапа и репликации vSphere лучше купить еще и Veeam Backup & Replication и реализовать и репликацию, и автоматический бэкап через VBR. При необходимости с VBR'ом мы можем реализовать и CDP.

**Сценарий 2.** Насколько я понимаю, KVM по больше части все же производительнее Xen'а, поэтому в этом случае я бы выбрал KVM. Поскольку он позволяет запустить в качестве гостевой системы и Linux, и Windows, он подходит по нашим требованиям. Поскольку я мало знаю о KVM'е и Xen'е, сложно сделать однозначный выбор. Я думаю, что я бы смотрел, на то, насколько сильно загружены наши сервисы, и какие у нас требования по отказоустойчивости и стабильности работы, какое RTO будет допустимым. С первого взгляда казалось, что KVM может быть неплохим вариантом, но, возможно, Xen в этом случае будет даже более предпочтительным как (судя по лекции и слайдам) более стабильный за счет предварительно выделенных CPU и RAM для гипервизора. Если это не какие-то супер загружаемые веб-сервисы, которые нужно на лету расширять и ужимать, то, возможно, все же я бы остановился на Xen'е.

**Сценарий 3.** Xen все же универсальный гипервизор из open source'а, он (судя по лекции и слайдам) надежен и стабилен, поэтому, я думаю, логичнее всего в этом случае думать сразу только про него. Правда, не до конца понимаю, как правильно стоит читать "бесплатное" — если мы не предполагаем, что мы используем пиратскую версию Windows Server'а, а все-таки предполагаем, что мы купили лицензии, то Microsoft Hyper-V встроен в Microsoft Server и в таком варианте он будет для нас бесплатным, никаких дополнительных расходов на покупку системы управления виртуализацией он от нас не потребует (если я правильно понимаю лицензирование Microsoft'а). И, конечно, он будет самым совместимым с Windows-инфраструктурой как нативное решение. 

**Сценарий 4.** Здесь бы я выбрал KVM — эта система изначально создана на Linux'е, это нативное решение. Для целей тестирования нам не нужен платный вариант с Red Hat Enterprise, достаточно будет воспользоваться удобным для нас дистрибутивом. KVM позволит нам создать бюджетную виртуальную среду-песочницу для тестирования.

## Задача 4
_Опишите возможные проблемы и недостатки гетерогенной среды виртуализации (использования нескольких систем управления виртуализацией одновременно) и что необходимо сделать для минимизации этих рисков и проблем. Если бы у вас был выбор, то создавали бы вы гетерогенную среду или нет? Мотивируйте ваш ответ примерами._

Из очевидных недостатков я, наверное, сразу вижу стоимость — если по какой-то причине мы одновременно используем VMware и Hyper-V, мы платим сразу за два продукта вместо одного, причем не только за сами продукты, но и еще за их саппорт.

Второй недостаток — отсутствие полного централизованного управления нашей виртуальной инфраструктурой. Если мы используем только, допустим, vSphere, то из vCenter'а мы можем управлять всей нашей инфраструктурой, а если она становится гетерогенной, нам необходимо использовать несколько утилит и помнить, какая часть инфраструктуры через что управляется.

Третий — необходимость или обучать своих инженеров, чтобы они умели работать со всеми используемыми гипервизорами, или нанимать/обучать отдельные команды для каждого гипервизора. Это лишние и денежные, и временные затраты.

Четвертый — разные гипервизоры используют разные дисковые форматы, и они могут между собой конфликтовать. [vSphere Land](http://vsphere-land.com/news/top-5-tips-for-managing-heterogeneous-virtual-environments.html) говорит, что между гипервизорами есть некоторая совместимость, но она, очевидно, далека от абсолютной. Этот недостаток я бы минимизировал как минимум разделением разных гипервизоров по разным хостам. На одном хосте работает, допустим, VMware, на другом — Hyper-V (или KVM, или Xen).

В общем случае, я бы, пожалуй, старался по возможности избежать гетерогенной инфраструктуры, если только этого реально не требуют условия работы. Допускаю, что для продакшна и разработки и тестирования требуются разные среды виртуализации, и такой кейс, пожалуй, наиболее допустим — это, по сути, практически две отдельные виртуальные инфраструктуры, каждая из которых гомогенна. Например, если в разработке нужно что-то тестировать на Linux'е, быстрее и проще развернуть тестовую среду на KVM'е и не вмешиваться в vSphere, используемую, например, в продакшне, но это, все же, пожалуй, история не о гетеро-/гомогенности среды, а о том, что необходимо разделять продакшн и разработку и не смешивать эти две инфраструктуры никаким образом.

Когда я говорю, что старался бы избегать гетерогенной инфраструктуры, я имею в виду структуры в пределах какой-то одной задачи — продакшн может работать на одной среде, разработка на другой. Как и всегда, все, конечно, зависит в том числе и от размера компании, и от ее задач, и от бюджета, которым она располагает. Если это энтерпрайз, который может себе позволить гетерогенную инфраструктуру (прямые расходы на покупку + саппорт + инженеры), и она ему действительно нужна (у такого решения есть понятные бизнес-ауткамы) то почему нет?  В любом случае, разные гипервизоры должны быть разделены физически — работать как минимум на разных хостах, а как максимум в разных частях компании (снова возвращаюсь к примеру с продакшном/разработкой). Если у нас есть какой-то отдельный физический офис, где по каким-то причинам лучше использовать другой гипервизор, это тоже вариант, инфраструктуры не перемешаны физически.
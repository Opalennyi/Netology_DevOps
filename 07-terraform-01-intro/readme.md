## Задача 1. Выбор инструментов. 
 
### Легенда
 
_Через час совещание на котором менеджер расскажет о новом проекте. Начать работу над которым надо 
будет уже сегодня. 
На данный момент известно, что это будет сервис, который ваша компания будет предоставлять внешним заказчикам.
Первое время, скорее всего, будет один внешний клиент, со временем внешних клиентов станет больше._

_Так же по разговорам в компании есть вероятность, что техническое задание еще не четкое, что приведет к большому
количеству небольших релизов, тестирований интеграций, откатов, доработок, то есть скучно не будет._  
   
_Вам, как девопс инженеру, будет необходимо принять решение об инструментах для организации инфраструктуры.
На данный момент в вашей компании уже используются следующие инструменты:_ 
- _остатки Сloud Formation,_ 
- _некоторые образы сделаны при помощи Packer,_
- _год назад начали активно использовать Terraform,_ 
- _разработчики привыкли использовать Docker,_ 
- _уже есть большая база Kubernetes конфигураций,_ 
- _для автоматизации процессов используется Teamcity,_ 
- _также есть совсем немного Ansible скриптов,_ 
- _и ряд bash скриптов для упрощения рутинных задач._  

_Для этого в рамках совещания надо будет выяснить подробности о проекте, что бы в итоге определиться с инструментами:_

1. _Какой тип инфраструктуры будем использовать для этого проекта: изменяемый или не изменяемый?_
1. _Будет ли центральный сервер для управления инфраструктурой?_
1. _Будут ли агенты на серверах?_
1. _Будут ли использованы средства для управления конфигурацией или инициализации ресурсов?_ 
 
_В связи с тем, что проект стартует уже сегодня, в рамках совещания надо будет определиться со всеми этими вопросами._

### В результате задачи необходимо

1. _Ответить на четыре вопроса представленных в разделе "Легенда"._ 
1. _Какие инструменты из уже используемых вы хотели бы использовать для нового проекта?_ 
1. _Хотите ли рассмотреть возможность внедрения новых инструментов для этого проекта?_ 

_Если для ответа на эти вопросы недостаточно информации, то напишите какие моменты уточните на совещании._

---

**1. Какой тип инфраструктуры будем использовать для этого проекта: изменяемый или не изменяемый?**

Я считаю, что предпочтительнее использовать неизменяемый (immutable) тип инфраструктуры, поскольку мы знаем, что ТЗ на данный момент нечеткое, что мы ожидаем огромное количество правок и переработок. Изменять инфраструктуру проще в виде кода, это позволит быстрее вносить правки, быстрее тестировать доработки.

**2. Будет ли центральный сервер для управления инфраструктурой?**

Полагаю, что в начале, пока инфраструктура сравнительно небольшая, можно не иметь центрального сервера. С ростом инфраструктуры и увеличении количества клиентов, центральный сервер может понадобиться для упрощения распределения и доставки обновлений — имея центральный сервер как абсолютную точку верификации, мы можем быть уверены, что все сервера будут иметь одну конфигурацию.

**3. Будут ли агенты на серверах?**

Я свято уверен, что это вообще неважно :) Я бы не стал выбирать такое ПО исходя из наличия или отсутствия агентов. Если бы я делал бэкап виртуальной инфраструктуры, я бы думал, хочу я бэкап агентский или безагентский, и какой лучше. В случае с выбором ПО — это не решающий фактор и не важный на этой стадии проекта.

**4. Будут ли использованы средства для управления конфигурацией или инициализации ресурсов?**

Да, поскольку в п. 1 мы решили, что у нас будет immutable инфраструктура. Поскольку нам важно описание серверов в виде кода для ускорения процесса их развёртки и внесения изменений и тестирования, мы будем использовать и средства для упраления конфигурацией, и средства для инициализации ресурсов. Описав инфраструктуру кодом, мы сможем довольно быстро вносить изменения в образы серверов.

**5. Какие инструменты из уже используемых вы хотели бы использовать для нового проекта?**

Поскольку уже есть годовой опыт использования Terraform'а, разумнее использовать его.

Разработчики привыкли использовать Docker и есть большая баша Kubernetes конфигураций — на данной стадии проекта у нас нет внешних требований, которые бы ограничивали использование этих инструментов. Принимая во внимание факт того, что команда уже привыкла с этими инструментами работать, оставляем их.

## Задача 2. Установка терраформ. 

_Официальный сайт: https://www.terraform.io/_

_Установите терраформ при помощи менеджера пакетов используемого в вашей операционной системе._
_В виде результата этой задачи приложите вывод команды `terraform --version`._

```shell
sergey.belov@Try-Goose-Grass-MacBook-Pro ~ % brew tap hashicorp/tap
Running `brew update --preinstall`...
==> Auto-updated Homebrew!
Updated 2 taps (hashicorp/tap and homebrew/core).
==> New Formulae
<...>
sergey.belov@Try-Goose-Grass-MacBook-Pro ~ % brew install hashicorp/tap/terraform
Error: Cannot install in Homebrew on ARM processor in Intel default prefix (/usr/local)!
Please create a new installation in /opt/homebrew using one of the
"Alternative Installs" from:
  https://docs.brew.sh/Installation
You can migrate your previously installed formula list with:
  brew bundle dump
```

Поскольку я работаю на MacBook'е с процессором M1, многие вещи приходится переустанавливать под новый процессор. Чтобы переустановить `brew`, запустим скрипт:
```shell
sergey.belov@Try-Goose-Grass-MacBook-Pro ~ % /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
==> Checking for `sudo` access (which may request your password)...
Password:
==> This script will install:
/opt/homebrew/bin/brew
/opt/homebrew/share/doc/homebrew
/opt/homebrew/share/man/man1/brew.1
/opt/homebrew/share/zsh/site-functions/_brew
/opt/homebrew/etc/bash_completion.d/brew
/opt/homebrew
==> The following new directories will be created:
<...>
==> Next steps:
- Run these two commands in your terminal to add Homebrew to your PATH:
    echo 'eval "$(/opt/homebrew/bin/brew shellenv)"' >> /Users/sergey.belov/.zprofile
    eval "$(/opt/homebrew/bin/brew shellenv)"
- Run brew help to get started
- Further documentation:
    https://docs.brew.sh

sergey.belov@Try-Goose-Grass-MacBook-Pro ~ % echo 'eval "$(/opt/homebrew/bin/brew shellenv)"' >> /Users/sergey.belov/.zprofile
sergey.belov@Try-Goose-Grass-MacBook-Pro ~ % eval "$(/opt/homebrew/bin/brew shellenv)"
```

По итогу можем установить Terraform:
```shell
sergey.belov@Try-Goose-Grass-MacBook-Pro ~ % brew tap hashicorp/tap
==> Tapping hashicorp/tap
Cloning into '/opt/homebrew/Library/Taps/hashicorp/homebrew-tap'...
<...>
Disable this behaviour by setting HOMEBREW_NO_INSTALL_CLEANUP.
Hide these hints with HOMEBREW_NO_ENV_HINTS (see `man brew`).

sergey.belov@Try-Goose-Grass-MacBook-Pro ~ % terraform --version
Terraform v1.2.6
on darwin_arm64
```

## Задача 3. Поддержка легаси кода. 

_В какой-то момент вы обновили терраформ до новой версии, например с 0.12 до 0.13._ 
_А код одного из проектов настолько устарел, что не может работать с версией 0.13._ 
_В связи с этим необходимо сделать так, чтобы вы могли одновременно использовать последнюю версию терраформа установленную при помощи
штатного менеджера пакетов и устаревшую версию 0.12._ 

_В виде результата этой задачи приложите вывод `--version` двух версий терраформа доступных на вашем компьютере 
или виртуальной машине._

Скачаем версию 1.1.9 Terraform (файл [terraform_1.1.9_darwin_arm64.zip](https://releases.hashicorp.com/terraform/1.1.9/terraform_1.1.9_darwin_arm64.zip)). Переименуем файл в архиве в `terraform119` и скопируем в директорию `/usr/local/bin/`.

```shell
sergey.belov@Try-Goose-Grass-MacBook-Pro ~ % terraform --version
Terraform v1.2.6
on darwin_arm64
sergey.belov@Try-Goose-Grass-MacBook-Pro ~ % terraform119 --version
Terraform v1.1.9
on darwin_arm64

Your version of Terraform is out of date! The latest version
is 1.2.6. You can update by downloading from https://www.terraform.io/downloads.html
```